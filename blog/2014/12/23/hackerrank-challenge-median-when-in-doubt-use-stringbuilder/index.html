
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Hackerrank Challenge: Median - when in doubt, use StringBuilder - Mango Ice Cream</title>
  <meta name="author" content="Kevin Pan">

  
  <meta name="description" content="This post provides a solution to the Hackerrank challenge, Median. Find out how to quickly maintain a running median of a constantly changing list of &hellip;">
  
  <meta name="keywords" content="">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://kevinpan.me/blog/2014/12/23/hackerrank-challenge-median-when-in-doubt-use-stringbuilder">
  <link href="/favicon.png" rel="icon">
  <link href='http://fonts.googleapis.com/css?family=Quicksand:300,400' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Mango Ice Cream" type="application/atom+xml">
  <script src="/js/jquery.js"></script>
  <script src="/js/bootstrap-collapse.js"></script>
  <script src="/js/modernizr-2.0.js"></script>
  <script src="/js/octopress.js" type="text/javascript"></script>
  <script src="/js/application.js"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  messageStyle: "none",
  "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
});
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57905192-1', 'auto');
  ga('send', 'pageview');

</script>
<body   >
  <div class="navbar navbar-inverse navbar-static-top">
    <div class="navbar-inner">
      <div class="container">
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".navbar-responsive-collapse">
          <span class="fui-menu-24"></span>
        </a>
        <div class="nav-collapse collapse navbar-responsive-collapse" style="height:0;">
          <ul class="nav">
    
        <li ><a href="/">Home</a></li>
    
        <li ><a href="/blog/archives">Archives</a></li>
    
        <li ><a href="http://www.kevinpan.ca/about">About Me</a></li>
    
</ul>

<ul class="nav pull-right">
    
    
    
    
    
    
    

    
</ul>

        </div>
      </div>
    </div>
  </div>
  <div class="container" id="main">
      <div class="row-fluid">
        <div id="content">
          <div>
<article class="hentry" role="article">
  

  <header>
  <div class="jumbotron">
    Hackerrank Challenge: Median - When in Doubt, Use StringBuilder
	<h5>




<i class="icon-calendar-empty"></i> <time class='entry-date' datetime='2014-12-23T18:48:51-08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>6:48 pm</span></time></h5>
  </div>
</header>
  <div class="row-fluid">
    <div class="span12">
      <p>In this Hackerrank challenge, you need to calculate a running median of a list of numbers where numbers can be both added and removed. Each time this is done, you need to output the median of the current list. I chose to use Java to solve this challenge.</p>

<p>One way to approach this problem is to maintain a sorted array. You find where you want to insert/delete elements using binary search and the median can be calculated by looking at element(s) at the halfway point of the list. However, the problem with using an array is that insertion/deletion is actually $O(n)$ (where $n$ is the size of the list) since you have to reposition all list elements after the inserted/removed element. It doesn’t matter if searching for where to insert/delete is $O(\log\ n)$. However, you can find the median of the list at any time in $O(1)$ because random access operations for an array is $O(1)$.</p>

<p>You can slightly improve upon this solution by using an ordered data structure that is not a list, such as C++’s <code>std::multiset</code>. Unfortunately, Java’s standard library does not have an equivalent data structure (the closest you get is <code>TreeSet</code> but it forbids repeated elements). You can, however, emulate the behaviour of <code>std::multiset</code> by using a <code>TreeMap</code> where the keys are unique elements in the running list and the values are the number of times they appear. Unfortunately, finding the median still takes $O(n)$.</p>

<h3 id="using-a-completely-different-approach">Using a completely different approach</h3>

<p>The above solution holds promise but there is a completely different and very efficient solution that finds a running median using two data structures instead of one. One data structure holds the bottom half of the <strong>ordered</strong> list (A) while the other holds the top half (B). Each time a number is added to the running list, if it is smaller than the max element of A, then add it to A, else add it to B. The median can be calculated from the two by looking at the max element of A or the min element of B or both if $n$ is even. For this to work, the difference in lengths between A and B must be at most one. If adding or removing a number from the running list causes the lengths to differ by two, you need to balance them by transferring a min/max element between the two structures.</p>

<p>The trick here is to find a type of data structure that allows you to quickly find and remove its max/min element while also allowing you to quickly insert and delete random elements.</p>

<p>One way to do this is to use priority queues. The bottom half of the running list will be stored in a max priority queue while the top half will be stored in a min priority queue. If the priority queues were implemented with a heap, insertion and balancing will have a time complexity of $O(\log\ n)$. Finding the median can be done in constant time. The only problem, though, is that removing a random element from a heap-based priority queue takes $O(n)$. I tried this solution on Hackerrank and sure enough, I get timeout errors.</p>

<p><img src="http://imgur.com/IqzOBvw.jpg" alt="Timeout error" /></p>

<h3 id="almost-a-solution">Almost a solution</h3>

<p>So, if not priority queues, what do we use?</p>

<p>The answer can be found by revisiting the <code>TreeMap</code> solution discussed before. Instead of using two priority queues, we can use two trees! Again, C++’s <code>std::multiset</code> datastructure would be perfect for this but since Java’s standard library doesn’t have the equivalent data structure, we need to use a <code>TreeMap</code> where keys are unique elements in the running list and the values are the number of times they appear.</p>

<ul>
  <li>Find max/min: $O(\log\ n)$</li>
  <li>Insertion/deletion: $O(\log\ n)$</li>
</ul>

<p>This means that each time an element is inserted or removed into the running list, the algorithm will take $O(\log\ n)$ to compute the median, much faster than the $O(n)$ priority queue solution.</p>

<p>At this point, I was sure I solved the challenge…</p>

<p><img src="http://imgur.com/6A7GO1A.jpg" alt="Timeout error again" /></p>

<h3 id="stringbuilder-to-the-rescue">StringBuilder to the rescue!</h3>

<p>I spent a couple hours mulling over what I could possibly optimize before realizing that I have had substantial success in the past when I stopped using a bunch of <code>System.out.println</code> statements and just aggregated all the output in one <code>StringBuilder</code> object. Everything could then be printed with just one <code>println</code> statement. Exhausted and frustrated from spending so much time on this problem, I tried it.</p>

<p>I still can’t believe it’s not butter.</p>

<p><img src="http://imgur.com/8S76uT2.jpg" alt="Success!" /></p>

<blockquote>
  <p>How much memory does it take to store a dinosaur’s DNA? A Pterobyte</p>
</blockquote>

<blockquote>
  <p>What a pteroble joke.</p>
</blockquote>

    </div>
  </div>



  <footer>
    <hr>
    
    <div class="row-fluid">
      
      <div class="span6">
        <p class="meta">
        
        


        </p>
      </div>
      
      <div class="span6 social-sharing">
        <div class="sharing">
  <div class="addthis_toolbox addthis_default_style ">
  
  
  <a class="addthis_button_tweet"></a>
  
  
  <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>

      </div>
      
      
    </div>
    
    <div class="row-fluid">
      <div class="span12">
        <p class="meta">
          
            <a class="basic-alignment left" href="/blog/2014/12/21/from-bust-to-boom/" title="Previous Post: My Newbie Experience with SEO">&laquo; My Newbie Experience with SEO</a>
          
          
            <a class="basic-alignment right" href="/blog/2014/12/27/notes-on-binary-indexed-trees/" title="Next Post: Notes on Binary Indexed Trees (Fenwick Trees)">Notes on Binary Indexed Trees (Fenwick Trees) &raquo;</a>
          
        </p>
      </div>
    </div>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>



        </div>
      </div>
      <div class="row-fluid">
        <footer class="footer-page" role="contentinfo">
          <p>
  Copyright &copy; 2016 - Kevin Pan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> - Theme by <a href="http://alexgaribay.com">Alex Garibay</a>
</p>


        </footer>
      </div>
  </div>
  

<script type="text/javascript">
      var disqus_shortname = 'mangoicecream';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://kevinpan.me/blog/2014/12/23/hackerrank-challenge-median-when-in-doubt-use-stringbuilder/';
        var disqus_url = 'http://kevinpan.me/blog/2014/12/23/hackerrank-challenge-median-when-in-doubt-use-stringbuilder/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
